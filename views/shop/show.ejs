<%
	var id = req.session.location.controller + "-" + req.session.location.action;
	shop

%>

<div class="container">
	<div id="<%= id %>">
		<h3>Fiche magasin</h3>

		<div class="row">
			<div class="col-sm-6">
				<div id="map-canvas"></div>
			</div>
			<div class="col-sm-6">
				contact
			</div>
		</div>

		<div class="row">
			
		</div>		


	</div>
</div>

<script type="text/javascript">
	var  documentLoaded = function (){	

		var shop = JSON.parse(_('<%= JSON.stringify(shop) %>').unescape());
		var location = shop.location;

		var mapOptions = {
			center: location,
			zoom: 15
		};
		var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

		var markers = {};
		markers.shop = new google.maps.Marker({
			position: location,
			map: map,
			title:"<%= shop.name %>"
		});

		var contentString = JST["assets/templates/map/info.ejs"]({
			shop : shop
		});

		var infowindow = new google.maps.InfoWindow({
			content: contentString
		});

		google.maps.event.addListener(markers.shop, 'click', function() {
			infowindow.open(map,markers.shop);
		});
	};

	window.addEventListener("load", documentLoaded);
	<% if(false === res.locals.layout){ %>
		documentLoaded();
	<% } %>
</script>

<script type="text/javascript"src="https://maps.googleapis.com/maps/api/js?key=<%= sails.config.google.keys.client %>"></script>


